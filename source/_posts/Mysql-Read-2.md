---
title: 高性能Mysql读后感-Schema与数据类型优化
date: 2019-07-18 19:07:55
tags: Mysql
---

### 如何定义合适的数据类型

## 1. 更小的通常更好

- 降低了存储空间，减少CPU和内存的开销
- 保证没有低估数据范围，扩容是一个耗时和痛苦的操作

## 2. 简单的更好

- 整型比字符串代价更低
- 例：用整型存储IP地址，用Date而不是字符串来存储日期和时间

## 3. 尽量避免NULL

- 可为NULL的列会占用更多的存储空间，在Mysql中需要很多特殊处理
- 可为NULL的列会使索引更加复杂，甚至可能导致固定大小的索引变成可大可小
- 将可为NULL改为NOT NULL对性能的提升比较小，所以除非确定这会导致问题，
  否则没必要去专门修改这种情况

## 4. 整数类型

- TINYINT(8) < SMALLINT(16) < MEDIUMINT(24) < INT(32) < BIGINT(64)
- 整数类型有UNSIGNED表示不允许负数，两者的存储空间和性能相同
- 整数类型指定宽度不会限制值的合法范围，只是单纯的用于展示
- 超过BIGINT长度的整数可以用实数类型或者字符串类型来存储

## 5. 实数类型

- 实数类型指包含小数部分的数字，单精度浮点数(FLOAT)和双精度浮点数(DOUBLE),定点类型(DECIMAL).
- FLOAT占用4个字节，DOUBLE占用8个字节, 比FLOAT有更高的精度和范围
- 浮点数是用二进制数据的科学计数法表示的，因此不能精确的表示实数.
- MYSQL5.0及以上的版本，DECIMAL类型最多允许65个数字.
- 在对小数进行精确计算和存储时，应尽量使用DECIMAL---如财务数据，交易数据.
- 在数据量较大的时候可以考虑使用BIGINT存储.

## 6. 字符串类型

- VARCHAR和CHAR是两种最主要的字符串类型
- BLOB和TEXT则是为存储大数据而设计的字符串

# VARCHAR：
- VARCHAR存储可变长字符串，并使用1或2个额外字节记录字符串长度，比定长字符串更节省空间
- 由于UPDATE可能使得行变的比原来长，导致需要做额外的工作。
- 5.0及以上的版本会存储VARCHAR末尾空格
- 使用VARCHAR的情况通常如下
     + 字符串列的最大长度比平均长度大很多，即字符串长度分布极不均匀
     + 较少的列更新频率
     + 使用了像UTF-8这样复杂的字符集，每个字符都使用不同的字节数存储

# CHAR：
- CHAR存储定长字符串，因此不容易产生碎片
- 存储CHAR类型时，Mysql会删除所有的末尾空格
- 使用CHAR的情况通常如下
    + 字符串长度较短
    + 较高的列更新频率
    + CHAR(1)比VARCHAR(1)在存储空间上更有效

## 7. 日期和时间类型


